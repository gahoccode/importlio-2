<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Optimization Results</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
<div class="container py-5">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}
    <h1 class="mb-4">Optimization Results</h1>
    <div id="metrics">
        <!-- Portfolio metrics will be rendered here -->
        {% if metrics %}
        <ul class="list-group mb-4">
            <li class="list-group-item">Expected Return: {{ metrics.exp_return }}%</li>
            <li class="list-group-item">Volatility: {{ metrics.volatility }}%</li>
            <li class="list-group-item">Sharpe Ratio: {{ metrics.sharpe_ratio }}</li>
        </ul>
        {% endif %}
    </div>
    <div class="row">
        <div class="col-md-12 mb-4">
            <h4>Efficient Frontier (PyPortfolioOpt Built-in)</h4>
            {% if efficient_frontier_img %}
            <img src="data:image/png;base64,{{ efficient_frontier_img }}" alt="Efficient Frontier Plot" class="img-fluid rounded border mb-3"/>
            {% endif %}
        </div>
        <div class="col-md-6">
            <div id="efficient-frontier"></div>
        </div>
        <div class="col-md-6">
            <div id="allocation-pie"></div>
        </div>
    </div>
    <a href="/" class="btn btn-secondary mt-4">Back</a>
</div>
<script src="{{ url_for('static', filename='js/script.js') }}"></script>
<script>
// Plotly: Efficient Frontier
var frontierData = {{ frontier_data|tojson }};
var traceFrontier = {
    x: frontierData.vols,
    y: frontierData.returns,
    mode: 'lines+markers',
    name: 'Efficient Frontier',
    line: {color: '#007bff'}
};
Plotly.newPlot('efficient-frontier', [traceFrontier], {
    title: 'Efficient Frontier',
    xaxis: {title: 'Volatility (%)'},
    yaxis: {title: 'Expected Return (%)'}
});
// Plotly: Allocation Pie
var allocationData = {{ allocation_data|tojson }};
var tracePie = {
    labels: allocationData.labels,
    values: allocationData.values,
    type: 'pie',
    textinfo: 'label+percent',
    hole: .4
};
Plotly.newPlot('allocation-pie', [tracePie], {
    title: 'Asset Allocation'
});
</script>
</body>
</html>
